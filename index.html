<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Kombinieren und Herunterladen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <h1>CSV Kombinieren und Herunterladen</h1>
    <input type="file" id="csvFileInput" accept=".csv">
    <button onclick="combineCSV()">CSV Kombinieren</button>
    <button id="downloadButton" style="display:none;" onclick="downloadCSV()">CSV Herunterladen</button>
    <br><br>
    <textarea id="output" rows="10" cols="100" placeholder="Das kombinierte Ergebnis wird hier angezeigt..."></textarea>

    <script>
        let combinedContent = '';

        document.getElementById('csvFileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                Papa.parse(e.target.result, {
                    delimiter: ";",
                    header: false,
                    encoding: "UTF-8",
                    complete: function(results) {
                        const data = results.data;
                        let combinedData = [];

                        data.forEach(row => {
                            combinedData = combinedData.concat(row.filter(cell => cell.trim() !== ''));
                        });

                        combinedContent = combinedData.map(cell => `"${cell.replace(/"/g, '""')}"`).join(';');
                        document.getElementById('output').value = combinedContent;
                        document.getElementById('downloadButton').style.display = 'inline';
                    },
                    error: function(error) {
                        alert('Fehler beim Parsen der Datei: ' + error.message);
                    }
                });
            };

            reader.onerror = function(error) {
                alert('Fehler beim Lesen der Datei: ' + error.message);
            };

            reader.readAsText(file, 'UTF-8');
        });

        function combineCSV() {
            const fileInput = document.getElementById('csvFileInput');
            if (!fileInput.files.length) {
                alert('Bitte w√§hle eine CSV-Datei aus.');
                return;
            }
        }

        function downloadCSV() {
            const blob = new Blob(['\ufeff' + combinedContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const downloadLink = document.createElement('a');

            downloadLink.href = url;
            downloadLink.download = 'kombiniert.csv';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
    </script>
</body>
</html>
